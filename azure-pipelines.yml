variables:
  DEVELOPER_DIR: "/Applications/Xcode_9.3.1.app"
jobs:
- job: build_osx
  pool:
    vmImage: 'macOS-10.13'
  timeoutInMinutes: 120
  steps:
  - script: echo multiple script test
  - script: ls -laR ./ext/
# ここで、各サブモジュールのビルド済みバイナリをDL
# なければビルド
# また、FORCE_BUILDが指定されているときは、DLしない
  - script: brew install libtool automake
  - script: export ENVVAR_TEST="envvar_test"
  - script: echo "$ENVVAR_TEST"
  - script: cd gradle && pwd
  - script: cd gradle && pwd
  - script: cd gradle && ./gradlew update_submodules
  - bash: "cd Project && echo execute bash script && printenv && pwd"
      name: "display name for bash"
  - script: cd gradle && ./gradlew build_all -Pconfig=Release
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: '$(System.DefaultWorkingDirectory)/build_release/Release'
      artifactName: Binary
- job: deploy
  steps:
  - task: DownloadBuildArtifacts@0
    displayName: "Download Artifacts"
    inputs:
      artifactName: Binary
  dependsOn: build_osx
  condition: succeeded()
